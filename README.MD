# Fun Radio Factures (periodic mail scheduling)

Envoyez p√©riodiquement, et facilement, vos factures √† **Fun Radio** pour augmenter vos chances.

## üöÄüöÄ Contexte

OUI, des solutions d'envoi de mails r√©currents existent d√©j√† (quelques exemples, pour la plupart payantes):

- [Boomerang for Gmail](https://www.boomeranggmail.com/l/how-to-send-recurring-emails.html)
- [rightinbox](https://www.rightinbox.com/features/recurring-emails)
- ...

MAIS, mon but ici est d'apprendre des choses, et donc, monter en comp√©tences:

- Apprendre le framework [Ktor](https://ktor.io/), et les paradigmes c√¥t√© serveurs / frontend
- Am√©liorer mes connaissances en **Kotlin**
- Monter en comp√©tence sur Docker, en _dockerizant_ une solution compl√®te, et la rendre facilement d√©ployable en quelques clics
- Ne pas limiter l'envoi de mail √† un seul type de service, et avoir une configuration souple
- Prendre du plaisir ‚ù§Ô∏è

## üåç Variables d'environnement (obligatoires)

### Base de donn√©es MongoDB

- `MONGO_USERNAME`: Nom d'utilisateur pour acc√©der √† la base de donn√©es
- `MONGO_PASSWORD`: Password de l'utilisateur
- `MONGO_HOSTNAME`: Adresse du serveur de la base de donn√©es (`localhost` si le serveur n'est pas dans un container, sinon il faut utiliser le nom du container par d√©faut `mongo_container`)
- `MONGO_PORT`: Port de la base de donn√©s (d√©faut: 27017)

### Configuration SMTP

- `SMTP_SERVER`: Adresse du server SMTP (ex: smtp.gmail.com)
- `SMTP_PORT`: Port du serveur SMTP (default: 587)
- `SMTP_USER`: Nom d'utilisateur
- `SMTP_PASSWORD`: Mot de passe de connexion

Un script est disponible pour utiliser utiliser les variables d'environnement. Il sera remplac√© √† terme par un fichier `.env` plus g√©n√©ral pour le _docker-compose_ et le serveur en lui-m√™me.

## üë©‚Äçüíª Comment utiliser l'application

Cette application peut s'utiliser via des appels REST ([REST Client pour VS Code](https://github.com/Huachao/vscode-restclient/releases))

Une interface web est en d√©veloppement pour faciliter son utilisation.

### Cr√©er un nouvel email (informations obligatoires)

```http
POST /upload HTTP/1.1
Host: localhost:8080
Content-Type: multipart/form-data; boundary=--------------------------423360379973048303416585

----WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="receiverEmail"

test
----WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="mailTitle"

title
----WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="mailBody"

body
----WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="repeat"

0
----WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="delayMillis"

10000
----WebKitFormBoundary7MA4YWxkTrZu0gW
```

```http
Email with id f4528697-9a71-468a-9e13-9a7abd2d36b7 has been created.
```

### Lancer l'envoi automatique de cet email

```http
POST http://localhost:8080/scheduling
Content-Type: application/json

{
    "start": true,
    "emailId": "f4528697-9a71-468a-9e13-9a7abd2d36b7"
}
```

### Arr√™ter l'envoi automatique de cet email

```http
POST http://localhost:8080/scheduling
Content-Type: application/json

{
    "start": false,
    "emailId": "f4528697-9a71-468a-9e13-9a7abd2d36b7"
}
```
